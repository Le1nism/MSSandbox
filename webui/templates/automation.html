<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>MSSandbox - Automation</title>
	<style>
		* { margin: 0; padding: 0; box-sizing: border-box; }

		body {
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			background: #0f0e17;
			color: #e6e6f0;
			min-height: 100vh;
			padding: 20px;
		}

		.container {
			max-width: 1400px;
			margin: 0 auto;
			background: #12121a;
			border-radius: 12px;
			box-shadow: 0 10px 24px rgba(0,0,0,0.4);
			overflow: hidden;
		}

		.header { background: #17172a; color: #e6e6f0; padding: 30px; text-align: center; }
		.header h1 { font-size: 2.2em; margin-bottom: 8px; }
		.header p { opacity: 0.9; }

		.navbar { display: flex; gap: 10px; justify-content: center; padding: 12px; background: #161622; border-bottom: 1px solid #252538; }
		.navbar a { color: #c8c8e0; text-decoration: none; padding: 8px 14px; border-radius: 8px; border: 1px solid transparent; }
		.navbar a.active { background: #6a61e0; border-color: #6a61e0; color: #fff; }
		.navbar a:hover { background: #1a1a2b; border-color: #2a2a3a; }

		.status-bar { display: flex; justify-content: space-around; padding: 20px; background: #161622; border-bottom: 1px solid #252538; }
		.service-status { text-align: center; padding: 15px; border-radius: 10px; min-width: 150px; }
		.service-status.healthy { background: #1a1f2e; color: #91ffb1; border: 1px solid #244b3f; }
		.service-status.unhealthy { background: #1f1a2e; color: #ff9aa2; border: 1px solid #4b2433; }

		.main-content { padding: 30px; }
		.automation-controls { background: #141424; border: 1px solid #23233a; border-radius: 10px; padding: 20px; margin-bottom: 30px; text-align: center; }
		.automation-buttons { display: flex; gap: 15px; justify-content: center; margin-bottom: 15px; }
		.btn { background: #5b51d8; color: #ffffff; border: 1px solid #6a61e0; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-size: 0.95em; transition: background 0.2s ease, transform 0.1s ease; min-width: 120px; }
		.btn:hover { transform: translateY(-1px); background: #6a61e0; }
		.btn:disabled { background: #3a3956; cursor: not-allowed; }
		.btn-start { background: #2cce89; border-color: #2cce89; }
		.btn-stop { background: #e0526f; border-color: #e0526f; }
		.btn-view { background: #6a61e0; border-color: #6a61e0; }
		.automation-status { font-size: 1.05em; font-weight: 600; margin-top: 8px; }
		.automation-status.running { color: #2cce89; }
		.automation-status.stopped { color: #e0526f; }

		.flow-diagram { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; padding: 20px; background: #141424; border-radius: 10px; }
		.service-box { text-align: center; padding: 20px; background: #16162a; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.4); flex: 1; margin: 0 10px; }
		.service-box h3 { color: #b4b0ff; margin-bottom: 10px; }
		.arrow { font-size: 2em; color: #6a61e0; margin: 0 20px; }

		.controls { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
		.control-card { background: #141424; border: 1px solid #23233a; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.3); }
		.control-card h3 { color: #d2d2e6; margin-bottom: 15px; font-size: 1.2em; }

		.data-flow { background: #141424; border: 1px solid #23233a; border-radius: 10px; padding: 20px; margin-top: 20px; }
		.data-flow h3 { color: #b4b0ff; margin-bottom: 15px; }
		.flow-step { display: flex; align-items: center; margin-bottom: 10px; padding: 10px; background: #16162a; border-radius: 5px; border-left: 4px solid #6a61e0; }
		.step-number { background: #6a61e0; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-weight: bold; }

		.data-display { background: #141424; border: 1px solid #23233a; border-radius: 10px; padding: 20px; margin-top: 20px; max-height: 600px; overflow-y: auto; }
		.data-display h3 { color: #d2d2e6; margin-bottom: 15px; }
		.data-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
		.data-table th, .data-table td { border: 1px solid #2a2a3a; padding: 12px; text-align: left; }
		.data-table th { background: #1a1a2b; font-weight: bold; color: #c8c8e0; }
		.data-table tr:nth-child(even) { background: #151525; }
		.data-table tr:hover { background: #181832; }
		.status-badge { padding: 4px 8px; border-radius: 12px; font-size: 0.8em; font-weight: bold; }
		.status-cold { background: #16324b; color: #a7c5eb; }
		.status-comfortable { background: #1b3a2a; color: #91ffb1; }
		.status-warm { background: #4b1f2b; color: #ff9aa2; }
		.status-dry { background: #4b4120; color: #ffe29a; }
		.status-normal { background: #1b3a2a; color: #91ffb1; }
		.status-humid { background: #16324b; color: #a7c5eb; }
		.status-stable { background: #1b3a2a; color: #91ffb1; }
		.status-variable { background: #4b1f2b; color: #ff9aa2; }

		.results { background: #141424; border: 1px solid #23233a; border-radius: 10px; padding: 20px; margin-top: 20px; }
		.results h3 { color: #d2d2e6; margin-bottom: 15px; }
		.json-display { background: #151525; border: 1px solid #23233a; border-radius: 5px; padding: 15px; font-family: 'Courier New', monospace; font-size: 0.9em; white-space: pre-wrap; max-height: 400px; overflow-y: auto; }
		.loading { text-align: center; color: #b4b0ff; font-style: italic; }
		.error { color: #ff9aa2; background: #2a1620; border: 1px solid #4b2433; border-radius: 5px; padding: 10px; margin-top: 10px; }
		.success { color: #91ffb1; background: #142a20; border: 1px solid #244b3f; border-radius: 5px; padding: 10px; margin-top: 10px; }

		.hidden { display: none; }
	</style>
</head>
<body>
	<div class="container">
		<div class="header">
			<h1>MSSandbox Dashboard</h1>
			<p>Automated data generation and processing system</p>
		</div>

		<div class="navbar">
			<a href="/automation" class="active">Automation</a>
			<a href="/benchmark">Benchmark</a>
		</div>

		<div class="status-bar">
			<div class="service-status" id="producer-status">
				<h3>Producer Service</h3>
				<p id="producer-health">Checking...</p>
			</div>
			<div class="service-status" id="consumer-status">
				<h3>Consumer Service</h3>
				<p id="consumer-health">Checking...</p>
			</div>
		</div>

		<div class="main-content">
			<div class="automation-controls">
				<h3>Automation Controls</h3>
				<div class="automation-buttons">
					<button class="btn btn-start" onclick="startAutomation()" id="start-btn">Start</button>
					<button class="btn btn-stop" onclick="stopAutomation()" id="stop-btn">Stop</button>
					<button class="btn btn-view" onclick="viewAllData()">View Data</button>
				</div>
				<div class="automation-status" id="automation-status">Checking automation status...</div>
			</div>

			<div class="flow-diagram">
				<div class="service-box">
					<h3>Producer</h3>
					<p>Automatically generates and sends sensor data</p>
				</div>
				<div class="arrow">→</div>
				<div class="service-box">
					<h3>Consumer</h3>
					<p>Processes and stores data with analysis</p>
				</div>
			</div>

			<div class="controls">
				<div class="control-card">
					<h3>Manual Controls</h3>
					<p>For testing individual operations</p>
					<button class="btn" onclick="generateData()">Generate Data</button>
					<button class="btn" onclick="sendData()">Send Data</button>
					<button class="btn" onclick="getProcessedData()">Get Processed</button>
				</div>

				<div class="control-card">
					<h3>Data Management</h3>
					<p>Manage stored data</p>
					<button class="btn" onclick="clearHistory()">Clear History</button>
					<button class="btn" onclick="showManualInput()">Manual Input</button>
				</div>
			</div>

			<div class="data-flow">
				<h3>Automated Data Flow</h3>
				<div class="flow-step">
					<div class="step-number">1</div>
					<div>
						<strong>START Automation:</strong> Producer automatically generates sensor data every 5 seconds
					</div>
				</div>
				<div class="flow-step">
					<div class="step-number">2</div>
					<div>
						<strong>Data Processing:</strong> Consumer receives, processes, and stores data with analysis
					</div>
				</div>
				<div class="flow-step">
					<div class="step-number">3</div>
					<div>
						<strong>VIEW Results:</strong> View all processed data in a formatted, human-readable table
					</div>
				</div>
				<div class="flow-step">
					<div class="step-number">4</div>
					<div>
						<strong>STOP Automation:</strong> Halt the automated data generation process
					</div>
				</div>
			</div>

			<div class="data-display hidden" id="data-display">
				<h3>Processed Data History</h3>
				<div id="data-table-container"></div>
			</div>

			<div class="results" id="results" style="display: none;">
				<h3>Results</h3>
				<div class="json-display" id="json-result"></div>
			</div>
		</div>
	</div>

	<script>
		let automationRunning = false;

		document.addEventListener('DOMContentLoaded', function() {
			checkStatus();
			checkAutomationStatus();
			setInterval(checkStatus, 10000);
			setInterval(checkAutomationStatus, 5000);
		});

		async function checkStatus() {
			try {
				const response = await fetch('/api/status');
				const data = await response.json();
				updateServiceStatus('producer', data.producer.healthy);
				updateServiceStatus('consumer', data.consumer.healthy);
			} catch (error) { console.error('Error checking status:', error); }
		}

		async function checkAutomationStatus() {
			try {
				const response = await fetch('/api/automation-status');
				const data = await response.json();
				automationRunning = data.automation_running;
				updateAutomationStatus();
			} catch (error) { console.error('Error checking automation status:', error); }
		}

		function updateServiceStatus(service, healthy) {
			const statusElement = document.getElementById(`${service}-status`);
			const healthElement = document.getElementById(`${service}-health`);
			if (healthy) { statusElement.className = 'service-status healthy'; healthElement.textContent = 'Healthy'; }
			else { statusElement.className = 'service-status unhealthy'; healthElement.textContent = 'Unhealthy'; }
		}

		function updateAutomationStatus() {
			const statusElement = document.getElementById('automation-status');
			const startBtn = document.getElementById('start-btn');
			const stopBtn = document.getElementById('stop-btn');
			if (automationRunning) {
				statusElement.textContent = 'Automation is RUNNING - Generating data every 5 seconds';
				statusElement.className = 'automation-status running';
				startBtn.disabled = true; stopBtn.disabled = false;
			} else {
				statusElement.textContent = 'Automation is STOPPED';
				statusElement.className = 'automation-status stopped';
				startBtn.disabled = false; stopBtn.disabled = true;
			}
		}

		async function startAutomation() {
			showLoading('Starting automation...');
			try { const response = await fetch('/api/start-automation'); const data = await response.json(); showResult(data, 'Automation Started Successfully'); checkAutomationStatus(); }
			catch (error) { showError('Failed to start automation: ' + error.message); }
		}

		async function stopAutomation() {
			showLoading('Stopping automation...');
			try { const response = await fetch('/api/stop-automation'); const data = await response.json(); showResult(data, 'Automation Stopped Successfully'); checkAutomationStatus(); }
			catch (error) { showError('Failed to stop automation: ' + error.message); }
		}

		async function viewAllData() {
			showLoading('Loading processed data...');
			try {
				const response = await fetch('/api/view-all-data');
				const data = await response.json();
				if (data.data && data.data.length > 0) { displayDataTable(data.data); }
				else { showResult(data, 'No processed data available'); }
			} catch (error) { showError('Failed to load data: ' + error.message); }
		}

		function displayDataTable(data) {
			const dataDisplay = document.getElementById('data-display');
			const container = document.getElementById('data-table-container');
			let tableHTML = `
				<table class="data-table">
					<thead>
						<tr>
							<th>Sensor ID</th>
							<th>Timestamp</th>
							<th>Temperature</th>
							<th>Humidity</th>
							<th>Pressure</th>
							<th>Temp Status</th>
							<th>Humidity Status</th>
							<th>Pressure Trend</th>
							<th>Quality Score</th>
						</tr>
					</thead>
					<tbody>
			`;
			data.forEach(item => {
				const timestamp = new Date(item.timestamp).toLocaleString();
				tableHTML += `
					<tr>
						<td><strong>${item.sensor_id}</strong></td>
						<td>${timestamp}</td>
						<td>${item.temperature}°C</td>
						<td>${item.humidity}%</td>
						<td>${item.pressure} hPa</td>
						<td><span class="status-badge status-${item.temperature_status.toLowerCase()}">${item.temperature_status}</span></td>
						<td><span class="status-badge status-${item.humidity_status.toLowerCase()}">${item.humidity_status}</span></td>
						<td><span class="status-badge status-${item.pressure_trend.toLowerCase()}">${item.pressure_trend}</span></td>
						<td>${item.data_quality_score}%</td>
					</tr>
				`;
			});
			tableHTML += '</tbody></table>';
			container.innerHTML = tableHTML;
			dataDisplay.classList.remove('hidden');
			document.getElementById('results').style.display = 'none';
		}

		async function clearHistory() {
			if (confirm('Are you sure you want to clear all processed data history?')) {
				showLoading('Clearing history...');
				try { const response = await fetch('/api/clear-history'); const data = await response.json(); showResult(data, 'History Cleared Successfully'); document.getElementById('data-display').classList.add('hidden'); }
				catch (error) { showError('Failed to clear history: ' + error.message); }
			}
		}

		async function generateData() { showLoading('Generating sensor data...'); try { const response = await fetch('/api/generate-data'); const data = await response.json(); showResult(data, 'Data Generated Successfully'); } catch (error) { showError('Failed to generate data: ' + error.message); } }
		async function sendData() { showLoading('Sending data from Producer to Consumer...'); try { const response = await fetch('/api/send-data'); const data = await response.json(); showResult(data, 'Data Sent Successfully'); } catch (error) { showError('Failed to send data: ' + error.message); } }
		async function getProcessedData() { showLoading('Getting processed data from Consumer...'); try { const response = await fetch('/api/get-processed-data'); const data = await response.json(); let message = 'Processed Data Retrieved Successfully'; if (data.data_source === 'cached') { message += ' (using cached data)'; } else if (data.data_source === 'fresh') { message += ' (using fresh data from producer)'; } showResult(data, message); } catch (error) { showError('Failed to get processed data: ' + error.message); } }

		function showManualInput() {
			const customData = { temperature: 22.5, humidity: 65.0, pressure: 1012.5, sensor_id: "MANUAL_SENSOR", timestamp: new Date().toISOString() };
			const result = confirm('Send this custom data to Consumer?\n\n' + JSON.stringify(customData, null, 2));
			if (result) { processCustomData(customData); }
		}

		async function processCustomData(data) {
			showLoading('Processing custom data...');
			try {
				const response = await fetch('/api/process-data', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
				const result = await response.json();
				showResult(result, 'Custom Data Processed Successfully');
			} catch (error) { showError('Failed to process custom data: ' + error.message); }
		}

		function showLoading(message) { const resultsDiv = document.getElementById('results'); const jsonResult = document.getElementById('json-result'); resultsDiv.style.display = 'block'; jsonResult.innerHTML = `<div class="loading">${message}</div>`; document.getElementById('data-display').classList.add('hidden'); }
		function showResult(data, message) { const resultsDiv = document.getElementById('results'); const jsonResult = document.getElementById('json-result'); resultsDiv.style.display = 'block'; jsonResult.innerHTML = `<div class="success">${message}</div>\n\n${JSON.stringify(data, null, 2)}`; document.getElementById('data-display').classList.add('hidden'); }
		function showError(message) { const resultsDiv = document.getElementById('results'); const jsonResult = document.getElementById('json-result'); resultsDiv.style.display = 'block'; jsonResult.innerHTML = `<div class="error">${message}</div>`; document.getElementById('data-display').classList.add('hidden'); }
	</script>
</body>
</html>


